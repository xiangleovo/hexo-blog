!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).TypeIt=e()}(this,function(){"use strict";const e=t=>Array.isArray(t),o=t=>e(t)?t:[t],n="data-typeit-id",a="ti-cursor",s={started:!1,completed:!1,frozen:!1,destroyed:!1},r={breakLines:!0,cursor:{autoPause:!0,autoPauseDelay:500,animation:{frames:[0,0,1].map(t=>({opacity:t})),options:{iterations:1/0,easing:"steps(2, start)",fill:"forwards"}}},cursorChar:"|",cursorSpeed:1e3,deleteSpeed:null,html:!0,lifeLike:!0,loop:!1,loopDelay:750,nextStringDelay:750,speed:100,startDelay:250,startDelete:!1,strings:[],waitUntilVisible:!1,beforeString:()=>{},afterString:()=>{},beforeStep:()=>{},afterStep:()=>{},afterComplete:()=>{}},i=(n,t=>document.createElement(t)),u=t=>document.createTextNode(t),h=(t,e="")=>{let s=i("style");s.id=e,s.appendChild(u(t)),document.head.appendChild(s)},l=t=>t=e(t)?t:[t/2,t/2],d=(t,e)=>Math.abs(Math.random()*(t+e-(t-e))+(t-e));const c=t=>Array.from(t);let f=t=>([...t.childNodes].forEach(e=>{if(e.nodeValue)return[...e.nodeValue].forEach(t=>{e.parentNode.insertBefore(u(t),e)}),void e.remove();f(e)}),t);const p=t=>{let e=document.implementation.createHTMLDocument();return e.body.innerHTML=t,f(e.body)};function m(t,e=!1,s=!1){let i,r=t.querySelector("."+a),n=document.createTreeWalker(t,NodeFilter.SHOW_ALL,{acceptNode:t=>{if(r&&s){if(t.classList?.contains(a))return NodeFilter.FILTER_ACCEPT;if(r.contains(t))return NodeFilter.FILTER_REJECT}return t.classList?.contains(a)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}),o=[];for(;i=n.nextNode();)i.originalParent||(i.originalParent=i.parentNode),o.push(i);return e?o.reverse():o}const y=t=>Number.isInteger(t),g=({queueItems:t,selector:i,cursorPosition:e,to:s})=>{if(y(i))return-1*i;let r=new RegExp("END","i").test(s),n=i?[...t].reverse().findIndex(({char:t})=>{let e=t.parentElement,s=e.matches(i);return!(!r||!s)||s&&e.firstChild.isSameNode(t)}):-1;return(n=n<0?r?0:t.length-1:n)-e+(r?0:1)},b=(t,e)=>new Array(e).fill(t);let v=e=>new Promise(t=>{requestAnimationFrame(async()=>{t(await e())})}),T=e=>e?.getAnimations().find(t=>t.id===e.dataset.tiAnimationId),P=({cursor:t,frames:e,options:s})=>{let i=t.animate(e,s);return i.pause(),i.id=t.dataset.tiAnimationId,v(()=>{v(()=>{i.play()})}),i},w=t=>t.func?.call(null);const C=t=>"value"in t;let E=t=>"function"==typeof t?t():t,I=(t,e=document,s=!1)=>e["querySelector"+(s?"All":"")](t);const q=(t,e)=>Object.assign({},t,e);let S={"font-family":"","font-weight":"","font-size":"","font-style":"","line-height":"",color:"",transform:"translateX(-.125em)"};return class{element;timeouts;cursorPosition;predictedCursorPosition;statuses={started:!1,completed:!1,frozen:!1,destroyed:!1,firing:!1};opts;id;queue;cursor;flushCallback=null;unfreeze=()=>{};constructor(t,e={}){this.opts=q(r,e),this.element="string"==typeof(t=t)?I(t):t,this.timeouts=[],this.cursorPosition=0,this.unfreeze=()=>{},this.predictedCursorPosition=null,this.statuses=q({},s),this.id=Math.random().toString().substring(2,9),this.queue=function(t){function e(t){return o(t).forEach(t=>n.set(Symbol(t.char?.innerText),i({...t}))),this}let i=t=>(t.shouldPauseCursor=function(){return Boolean(this.typeable||this.cursorable||this.deletable)},t),s=()=>n,r=()=>Array.from(n.values()),n=new Map;return e(t),{add:e,set:function(t,e){var s=[...n.keys()];n.set(s[t],i(e))},wipe:function(){n=new Map,e(t)},done:(t,e=!1)=>e?n.delete(t):n.get(t).done=!0,reset:function(){n.forEach(t=>delete t.done)},destroy:t=>n.delete(t),getItems:(t=!1)=>t?r():r().filter(t=>!t.done),getQueue:s,getTypeable:()=>r().filter(t=>t.typeable),getPendingQueueItems:()=>{const t=[];for(var[,e]of n)e.done||t.push(e);return t}}}([{delay:this.opts.startDelay}]),this.#e(e),this.cursor=this.#t(),this.element.dataset.typeitId=this.id,h("[data-typeit-id]:before {content: '.'; display: inline-block; width: 0; visibility: hidden;}"),this.opts.strings.length&&this.#s()}go(){return this.statuses.started||(this.#i(),this.opts.waitUntilVisible?(s=this.element,i=this.#r.bind(this),new IntersectionObserver((t,e)=>{t.forEach(t=>{t.isIntersecting&&(i(),e.unobserve(s))})},{threshold:1}).observe(s)):this.#r()),this;var s,i}destroy(t=!0){this.timeouts=(this.timeouts.forEach(clearTimeout),[]),E(t)&&this.cursor&&this.#n(this.cursor),this.statuses.destroyed=!0}reset(t){for(var e in this.is("destroyed")||this.destroy(),t?(this.queue.wipe(),t(this)):this.queue.reset(),this.cursorPosition=0,this.statuses)this.statuses[e]=!1;return this.element[this.#o()?"value":"innerHTML"]="",this}is=function(t){return this.statuses[t]};type(t,e={}){t=E(t);let s=e["instant"],i=this.#a(e),r=([o,a=!0]=[t,this.opts.html],(a?m(p(o)):c(o).map(u)).map(t=>{return{func:()=>this.#u(t),char:t,delay:s||/<(.+)>(.*?)<\/(.+)>/.test(t.outerHTML)?0:this.#l(),typeable:t.nodeType===Node.TEXT_NODE}})),n=[i[0],{func:async()=>this.opts.beforeString(t,this)},...r,{func:async()=>this.opts.afterString(t,this)},i[1]];var o,a;return this.#h(n,e)}break(t={}){return this.#h({func:()=>this.#u(i("BR")),typeable:!0},t)}move(t,e={}){t=E(t);let s=this.#a(e),{instant:i,to:r}=e,n=g({queueItems:this.queue.getTypeable(),selector:null===t?"":t,to:r,cursorPosition:this.#d}),o=n<0?-1:1;return this.predictedCursorPosition=this.#d+n,this.#h([s[0],...b({func:()=>this.#p(o),delay:i?0:this.#l(),cursorable:!0},Math.abs(n)),s[1]],e)}exec(t,e={}){var s=this.#a(e);return this.#h([s[0],{func:()=>t(this)},s[1]],e)}options(t,e={}){return t=E(t),this.#c(t),this.#h({},e)}pause(t,e={}){return this.#h({delay:E(t)},e)}delete(t=null,e={}){t=E(t);let s=this.#a(e),i=t,{instant:r,to:n}=e,o=this.queue.getTypeable(),a=null===i?o.length:y(i)?i:g({queueItems:o,selector:i,cursorPosition:this.#d,to:n});return this.#h([s[0],...b({func:this.#f.bind(this),delay:r?0:this.#l(1),deletable:!0},a),s[1]],e)}freeze(){this.statuses.frozen=!0}flush(t=null){return this.flushCallback=t||this.flushCallback,this.statuses.firing||(this.#i(),this.#r(!1).then(()=>{if(0<this.queue.getPendingQueueItems().length)return this.flush();this.flushCallback(),this.flushCallback=null})),this}getQueue(){return this.queue}getOptions(){return this.opts}updateOptions(t){return this.#c(t)}getElement(){return this.element}empty(t={}){return this.#h({func:this.#m.bind(this)},t)}async#m(){this.#o()?this.element.value="":this.#y.forEach(this.#n.bind(this))}async#r(e=!0){this.statuses.started=!0,this.statuses.firing=!0;var s=t=>{this.queue.done(t,!e)};try{var i=[...this.queue.getQueue()];for(let t=0;t<i.length;t++){var[r,n]=i[t];if(!n.done){if(!n.deletable||n.deletable&&this.#y.length){var o=await this.#g(t,i),{index:a,newIndex:u,queueItems:h,cleanUp:l}=[{index:t,newIndex:o,queueItems:i,cleanUp:s}][0];for(let t=a+1;t<u+1;t++)l(h[t][0]);t=o}s(r)}}if(!e)return this.statuses.firing=!1,this;if(this.statuses.completed=!0,this.statuses.firing=!1,await this.opts.afterComplete(this),!this.opts.loop)throw"";let t=this.opts.loopDelay;this.#b(async()=>{await this.#P(t[0]),this.#r()},t[1])}catch(t){}return this.statuses.firing=!1,this}async#p(s){this.cursorPosition=(i=this.cursorPosition,r=this.#y,Math.min(Math.max(i+s,0),r.length));{var i=this.element,r=(s=this.#y,this.cursorPosition);let t=s[r-1],e=I("."+a,i);return void(i=t?.parentNode||i).insertBefore(e,t||null)}}async#P(t){var e=this.#d,s=(e&&await this.#p({value:e}),this.#y.map(t=>[Symbol(),{func:this.#f.bind(this),delay:this.#l(1),deletable:!0,shouldPauseCursor:()=>!0}]));for(let t=0;t<s.length;t++)await this.#g(t,s);this.queue.reset(),this.queue.set(0,{delay:t})}#g(t,e){return(async({index:t,queueItems:e,wait:s,cursor:i,cursorOptions:r})=>{let n=e[t][1],o=[],a=t,u=n,h=()=>u&&!u.delay,l=n.shouldPauseCursor()&&r.autoPause;for(;h();)o.push(u),h()&&a++,u=e[a]?e[a][1]:null;if(o.length)return await v(async()=>{for(var t of o)await w(t)}),a-1;let d,c=T(i);return c&&(d={...c.effect.getComputedTiming(),delay:l?r.autoPauseDelay:0}),await s(async()=>{c&&l&&c.cancel(),await v(()=>{w(n)})},n.delay),await(({cursor:i,options:r,cursorOptions:n})=>{if(i&&n){let t,e=T(i),s=(e&&(r.delay=e.effect.getComputedTiming().delay,t=e.currentTime,e.cancel()),P({cursor:i,frames:n.animation.frames,options:r}));return t&&(s.currentTime=t),s}})({cursor:i,options:d,cursorOptions:r}),t})({index:t,queueItems:e,wait:this.#b.bind(this),cursor:this.cursor,cursorOptions:this.opts.cursor})}async#b(t,e,s=!1){var i,r,n;this.statuses.frozen&&await new Promise(t=>{this.unfreeze=()=>{this.statuses.frozen=!1,t()}}),s||await this.opts.beforeStep(this),i=t,r=e,n=this.timeouts,await new Promise(t=>{n.push(setTimeout(async()=>{await i(),t()},r||0))}),s||await this.opts.afterStep(this)}async#i(){if(!this.#o()&&this.cursor&&this.element.appendChild(this.cursor),this.#C){{var s=this.id;var r=this.element;let t=`[${n}='${s}'] .`+a,i=getComputedStyle(r),e=Object.entries(S).reduce((t,[e,s])=>`${t} ${e}: var(--ti-cursor-${e}, ${s||i[e]});`,"");h(t+` { display: inline-block; width: 0; ${e} }`,s)}this.cursor.dataset.tiAnimationId=this.id;var r=this.opts.cursor["animation"],{frames:s,options:r}=r;P({frames:s,cursor:this.cursor,options:{duration:this.opts.cursorSpeed,...r}})}}#o(){return C(this.element)}#h(t,e){return this.queue.add(t),this.#I(e),this}#I(t={}){t=t.delay;t&&this.queue.add({delay:t})}#a(t={}){return[{func:()=>this.#c(t)},{func:()=>this.#c(this.opts)}]}async#c(t){this.opts=q(this.opts,t)}#s(){let s=this.opts.strings.filter(t=>!!t);s.forEach((t,e)=>{this.type(t),e+1!==s.length&&(t=this.opts.breakLines?[{func:()=>this.#u(i("BR")),typeable:!0}]:b({func:this.#f.bind(this),delay:this.#l(1)},this.queue.getTypeable().length),this.#v(t))})}#e=t=>{this.opts.cursor=(i=>{if("object"!=typeof i)return!0===i?r.cursor:i;{let t={},{frames:e,options:s}=r.cursor.animation;return t.animation=i.animation||{},t.animation.frames=i.animation?.frames||e,t.animation.options=q(s,i.animation?.options||{}),t.autoPause=i.autoPause??r.cursor.autoPause,t.autoPauseDelay=i.autoPauseDelay||r.cursor.autoPauseDelay,t}})(t.cursor??r.cursor),this.opts.strings=this.#w(o(this.opts.strings)),this.opts=q(this.opts,{html:!this.#T&&this.opts.html,nextStringDelay:l(this.opts.nextStringDelay),loopDelay:l(this.opts.loopDelay)})};#w(t){var e=this.element.innerHTML;return e?(this.element.innerHTML="",this.opts.startDelete?(this.element.innerHTML=e,f(this.element),this.#v(b({func:this.#f.bind(this),delay:this.#l(1),deletable:!0},this.#y.length)),t):e.replace(/<!--(.+?)-->/g,"").trim().split(/<br(?:\s*?)(?:\/)?>/).concat(t)):t}#t(){if(this.#T)return null;let t=i("span");return t.className=a,this.#C?t.innerHTML=p(this.opts.cursorChar).innerHTML:t.style.visibility="hidden",t}#v(t){var e=this.opts.nextStringDelay;this.queue.add([{delay:e[0]},...t,{delay:e[1]}])}#u(e){var s=this.element;if(C(s))s.value=""+s.value+e.textContent;else{e.innerHTML="";i=e.originalParent;let t=!/body/i.test(i?.tagName)&&e.originalParent||s;var i=I("."+a,t)||null;(t=i&&i.parentElement!==t?i.parentElement:t).insertBefore(e,i)}}#f(){this.#y.length&&(this.#T?this.element.value=this.element.value.slice(0,-1):this.#n(this.#y[this.cursorPosition]))}#n(e){var s=this.element;if(e){let t=e.parentNode;(1<t.childNodes.length||t.isSameNode(s)?e:t).remove()}}#l(t=0){return function(t){let{speed:e,deleteSpeed:s,lifeLike:i}=t;return s=null!==s?s:e/3,i?[d(e,e/2),d(s,s/2)]:[e,s]}(this.opts)[t]}get#d(){return this.predictedCursorPosition??this.cursorPosition}get#T(){return C(this.element)}get#C(){return!!this.opts.cursor&&!this.#T}get#y(){return t=this.element,C(t)?c(t.value):m(t,!0).filter(t=>!(0<t.childNodes.length));var t}}});